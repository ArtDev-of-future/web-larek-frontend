# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

Класс `AppState` является подклассом абстрактного класса `Model`, который предоставляет базовую реализацию для управления состоянием приложения. Класс `AppState` отвечает за управление каталогом, корзиной, заказом и ошибками формы приложения.

Свойства
`loading`: Булевое значение, указывающее, загружается ли приложение данные в данный момент.
`catalog`: Массив объектов ICard, представляющий каталог приложения.
`basket`: Массив объектов ICard, представляющий элементы в корзине пользователя.
`order`: Объект IItemInit, представляющий заказ пользователя.
preview: Строковое или null-значение, представляющее текущий просматриваемый элемент.
`formErrors`: Объект FormErr, представляющий ошибки валидации формы.
Методы
`buttonLogic(item: ICard): boolean`
Возвращает булевое значение, указывающее, находится ли данный объект ICard в корзине пользователя.

`add(card: ICard)`
Добавляет данный объект ICard в корзину пользователя, если он не присутствует и имеет действительную цену. Вызывает событие basket:changed с обновленной корзиной.

`remove(card: ICard)`
Удаляет данный объект ICard из корзины пользователя. Вызывает событие basket:changed с обновленной корзиной.

`clear()`
Очищает корзину пользователя. Вызывает событие basket:changed с обновленной корзиной.

`validate()`
Валидирует заказ пользователя и возвращает булевое значение, указывающее, является ли заказ валидным. Если заказ не валиден, заполняет объект formErrors сообщениями об ошибках и вызывает событие formErrors:change.

`catalogInit(data: ICard[])`
Инициализирует каталог приложения данным массивом объектов ICard. Вызывает событие items:changed с обновленным каталогом.

`previewInit(data: ICard)`
Инициализирует текущий просматриваемый элемент данным объектом ICard. Вызывает событие preview:changed с обновленным просмотром.

`orderInit(field: keyof IItemInit, value: string | number)`
Обновляет заказ пользователя с данным полем и значением. Если заказ становится валидным после обновления, вызывает событие order:ready с обновленным заказом.

События
Класс `AppState` вызывает следующие события:

`basket:changed`: Вызывается, когда корзина пользователя изменяется.
`formErrors:change`: Вызывается, когда ошибки валидации формы изменяются.
`items:changed`: Вызывается, когда каталог приложения изменяется.
`preview:changed`: Вызывается, когда текущий просматриваемый элемент изменяется.
`order:ready`: Вызывается, когда заказ пользователя становится валидным и готовым для отправки.

---

Класс `Form` - это generic-компонент, который расширяет класс `Component` и используется для создания формы с кнопкой отправки и обработкой ошибок. Он принимает два типа параметров: `T`, который представляет тип данных формы, и `IFormState`, который представляет состояние формы.

Конструктор
Конструктор принимает два параметра:

`container`: HTML-элемент формы, который будет содержать форму.
`events`: Экземпляр интерфейса `IEvents`, который используется для эмита событий при отправке формы или изменении поля ввода.
Свойства
`submit`: HTML-элемент кнопки, используемый для отправки формы.
`_errors`: HTML-элемент, отображающий сообщения об ошибках.
Методы
`onInputChange`
Параметры:
`field`: Ключ поля ввода, которое изменилось.
`value`: Новое значение поля ввода.
Эмитит событие с именем `${this.container.name}.${String(field)}:change` и передает объект с свойствами `field` и `value`.
`set errors`
Параметры:
`value`: Сообщение об ошибке для отображения.
Устанавливает текстовое содержимое элемента `_errors` в переданное сообщение об ошибке.
`set valid`
Параметры:
`value`: Булевое значение, указывающее, является ли форма валидной или нет.
Включает или отключает кнопку отправки в зависимости от переданного значения.
`render`
Параметры:
`data`: Объект, содержащий данные формы, включая свойства `valid` и `errors`.
Отрисовывает форму с переданными данными и возвращает контейнерный элемент.
Слушатели событий
Компонент формы слушает два события:

`input`: Когда поле ввода изменяется, он вызывает метод `onInputChange` с измененным полем и значением.
`submit`: Когда форма отправляется, он предотвращает поведение по умолчанию и эмитит событие с именем `${this.container.name}:submit`.
Типы параметров
`T`: Тип данных формы.
`IFormState`: Тип состояния формы.
Зависимости
`IEvents`: Интерфейс, предоставляющий эмиттер событий.
`Component`: Базовый класс компонента, предоставляющий основную функциональность.
`ensureElement`: Утилитарная функция, обеспечивающая существование элемента в контейнере.
`utils`: Модуль утилит, предоставляющий функцию `ensureElement`.

---

Класс `ViewBasket` - это компонент, который расширяет класс `Component` и используется для рендеринга представления корзины. Он принимает объект `IBasket` как параметр типа.

Конструктор

Конструктор принимает два параметра:

`container: HTMLElement`: HTML-элемент, который будет содержать представление корзины.
`events: EventEmitter`: Эмиттер событий, который будет использоваться для эмиссии событий.
Свойства

`list: HTMLElement`: HTML-элемент, который будет содержать список элементов в корзине.
`_total: HTMLElement`: HTML-элемент, который будет отображать общую цену элементов в корзине.
`button: HTMLElement`: HTML-элемент, который будет использоваться для триггера события "order:open".
`items: HTMLElement[]`: Массив HTML-элементов, представляющих элементы в корзине.
`selected: ICard[]`: Массив объектов `ICard`, представляющих выбранные элементы в корзине.
`total`: number: Общая цена элементов в корзине.
Методы

`set items(values: HTMLElement[])`: Устанавливает элементы в корзине. Если массив не пуст, он заменяет дочерние элементы элемента `list` новыми элементами. Если массив пуст, он добавляет параграфический элемент с текстом "Корзина пуста".
`set selected(items: ICard[])`: Устанавливает выбранные элементы в корзине. Если массив не пуст, он активирует элемент `button`. Если массив пуст, он деактивирует элемент `button`.
`set total(value: number)`: Устанавливает общую цену элементов в корзине. Он обновляет текстовое содержимое элемента `_total` с отформатированной общей ценой.
Слушатели событий

Элемент `button` имеет слушатель события клика, который эмитирует событие "order:open" при клике.
Зависимости

Функции `createElement` и `ensureElement` из модуля `../../utils/utils`.
Класс `EventEmitter` из модуля `../base/events`.
Функция `formatNumber` из модуля `./view`.
Класс `Component` из модуля `../base/component`;
Интерфейсы `IBasket` и `ICard` из модуля `../../types`.

---

Класс `Card` представляет собой компонент, который представляет элемент карточки в приложении. Он расширяет класс `Component` и принимает объект `ICard` в качестве типа параметра.

Конструктор

Конструктор принимает два параметра:

`container`: Объект `HTMLElement`, который представляет контейнерный элемент карточки.
`actions`: Необязательный объект `ICardAction`, который определяет действия, которые необходимо выполнить над карточкой.
Свойства

Класс `Card` имеет следующие свойства:

`_button`: Объект `HTMLButtonElement`, который представляет кнопочный элемент карточки.
`_image`: Объект `HTMLImageElement`, который представляет изображение элемента карточки.
`_title`: Объект `HTMLElement`, который представляет заголовок элемента карточки.
`_description`: Объект `HTMLElement`, который представляет описание элемента карточки.
`_price`: Объект `HTMLElement`, который представляет цену элемента карточки.
`_category`: Объект `HTMLElement`, который представляет категорию элемента карточки.
`_basketId`: Объект `HTMLElement`, который представляет идентификатор корзины элемента карточки.
Методы

Класс `Card` имеет следующие методы:

`set id(value: string)`: Устанавливает идентификатор карточки.
`get id(): string`: Возвращает идентификатор карточки.
`set basketId(value: string)`: Устанавливает идентификатор корзины карточки.
`get basketId(): string`: Возвращает идентификатор корзины карточки.
`private color(value: string): string`: Возвращает CSS-класс для элемента категории на основе значения.
`set category(value: string)`: Устанавливает категорию карточки.
`get category(): string`: Возвращает категорию карточки.
`set title(value: string)`: Устанавливает заголовок карточки.
`get title(): string`: Возвращает заголовок карточки.
`set image(value: string)`: Устанавливает изображение карточки.
`set description(value: string)`: Устанавливает описание карточки.
`set button(value: string)`: Устанавливает текст кнопки карточки.
`set price(value: number | null)`: Устанавливает цену карточки.
`get price(): number`: Возвращает цену карточки.

---

Класс `Modal` - это компонент, который расширяет класс `Component` и предоставляет функциональность модального окна. Он принимает объект `IModal` в качестве параметра и отображает модальное окно с предоставленными данными.

Конструктор

Конструктор принимает два параметра:

`container: HTMLElement`: Элемент контейнера, где будет отображаться модальное окно.
`events: IEvents`: Объект, который предоставляет функциональность обработки событий.
Свойства

`_content: HTMLElement`: Элемент контента модального окна.
`closeButton: HTMLButtonElement`: Элемент кнопки закрытия модального окна.
`escapeKeyListener: (event: KeyboardEvent) => void`: Функция, которая слушает событие нажатия клавиши Escape.
Методы

`set content(value: HTMLElement)`
Устанавливает контент модального окна в предоставленный `HTMLElement`.

`changeVisibility(force?: boolean)`
Переключает видимость модального окна. Если `force` равен `true`, модальное окно будет принудительно отображаться или скрываться.

`open()`
Открывает модальное окно, выполняя следующие действия:

Устанавливает свойство `overflow` объекта `document.body` в `hidden`.
Вызывает `changeVisibility(true)`.
Добавляет слушатель событий к объекту `document`, чтобы слушать событие нажатия клавиши Escape.
`close()`
Закрывает модальное окно, выполняя следующие действия:

Устанавливает свойство `overflow` объекта `document.body` в `visible`.
Вызывает `changeVisibility(false)`.
Удаляет слушатель событий из объекта `document`.
Устанавливает контент модального окна в `null`.
`render(data: IModal): HTMLElement`
Отображает модальное окно с предоставленными данными `IModal` и открывает его. Возвращает элемент контейнера модального окна.

Слушатели событий

Модальное окно слушает следующие события:
Событие клика на кнопке закрытия: Закрывает модальное окно.
Событие клика на контейнере: Закрывает модальное окно.
Событие клика на контенте: Останавливает распространение события.
Событие нажатия клавиши на документе: Слушает событие нажатия клавиши Escape и закрывает модальное окно, если она была нажата.

---

Класс `Order` является подклассом `Form`, который представляет форму заказа. Он расширяет класс `Form` с дополнительной функциональностью, специфичной для форм заказа.

Конструктор
`constructor(container: HTMLFormElement, events: IEvents)`
Конструктор принимает два параметра:

`container`: HTML-элемент формы, который содержит форму заказа.
`events`: Экземпляр `IEvents`, который обрабатывает события, эмитированные формой заказа.
Свойства
`paymentButton: HTMLButtonElement[]`
Массив HTML-элементов кнопок с классом `button_alt` внутри контейнера формы заказа.

Методы
`set address(value: string)`
Устанавливает значение поля ввода `address` в форме заказа.

`set email(value: string)`
Устанавливает значение поля ввода `email` в форме заказа.

`set phone(value: string)`
Устанавливает значение поля ввода `phone` в форме заказа.

`selected(name: string)`
Обрабатывает выбор метода оплаты. Он:

Переключает класс `button_alt-active` на выбранной кнопке оплаты.
Эмитит событие `order:change` с именем выбранного метода оплаты.

Класс `Order` эмитит событие `order:change`, когда изменяется метод оплаты. Payload события содержит имя выбранного метода оплаты.

---

Класс: `Success`

Расширяет: `Component<ISuccess>`

Описание: Класс `Success` является компонентом, представляющим сообщение об успехе или уведомление. Он расширяет класс `Component` и предоставляет дополнительную функциональность, специфичную для сообщений об успехе.

Конструктор:

```typescript
constructor(container: HTMLElement, actions: ISuccessActions)
```

Параметры:

`container`: HTML-элемент, который будет содержать сообщение об успехе.
`actions`: Объект, предоставляющий дополнительные действия для сообщения об успехе, такие как обработчик события `onClick`.
Свойства:

`_total`: HTML-элемент, отображающий общее значение сообщения об успехе.
`close`: HTML-элемент, представляющий кнопку закрытия сообщения об успехе.
Методы:

`set total(value: string)`
Устанавливает общее значение сообщения об успехе.

Параметры:

`value`: Новое общее значение, которое будет отображено.
Описание: Этот метод обновляет текстовое содержимое элемента `_total` с помощью предоставленного `value`.

Слушатели событий:

Элемент `close` имеет слушатель событий, прикрепленный к нему, который слушает события `click`. Когда событие `click` происходит, вызывается обработчик события `onClick`, предоставленный в объекте действия.
Зависимости:

`ISuccess`: Интерфейс, определяющий форму данных сообщения об успехе.
`ISuccessActions`: Интерфейс, определяющий форму дополнительных действий для сообщения об успехе.
`ensureElement`: Утилитарная функция, обеспечивающая существование HTML-элемента с заданным селектором внутри контейнерного элемента.
`Component`: Базовый класс, предоставляющий общую функциональность для компонентов.

---

Абстрактный класс `Component` является базовым классом для компонентов, которые могут быть отображены в HTML-элемент.

Конструктор
`constructor(protected container: HTMLElement)`: Инициализирует компонент с контейнерным элементом.
Методы
`tgClass(element: HTMLElement, className: string, isAdd?: boolean)`: Переключает класс на элементе.
Параметры:
`element`: Элемент, на котором нужно переключить класс.
`className`: Класс, который нужно переключить.
`isAdd`: Флаг, указывающий, нужно ли добавить или удалить класс (по умолчанию - `true`).
`protected setText(element: HTMLElement, text: string)`: Устанавливает текстовое содержимое элемента.
Параметры:
`element`: Элемент, на котором нужно установить текстовое содержимое.
`text`: Текстовое содержимое, которое нужно установить.
`disable(element: HTMLElement, state: boolean)`: Включает или отключает элемент.
Параметры:
`element`: Элемент, который нужно включить или отключить.
`state`: Флаг, указывающий, нужно ли включить или отключить элемент.
`protected hide(element: HTMLElement)`: Скрывает элемент, установив его стиль отображения в `none`.
Параметры:
`element`: Элемент, который нужно скрыть.
`protected show(element: HTMLElement)`: Показывает элемент, удаляя его стиль отображения.
Параметры:
`element`: Элемент, который нужно показать.
`protected IMG(element: HTMLElement, src: string, alt?: string)`: Устанавливает атрибуты источника и альтернативного текста для элемента изображения.
Параметры:
`element`: Элемент изображения, на котором нужно установить атрибуты.
`src`: URL-адрес источника изображения.
`alt`: Альтернативный текст изображения (необязательный).
`render(data?: Partial<T>): HTMLElement`: Отрисовывает компонент с необязательными данными.
Параметры:
`data`: Необязательные данные для отрисовки.
Возвращает: Отрисованный HTML-элемент.

---

Класс `View` расширяет абстрактный класс `Component` и предоставляет дополнительную функциональность для компонента вида.

Конструктор
`constructor(container: HTMLElement, protected events: IEvents)`: Инициализирует компонент вида с контейнерным элементом и объектом событий.
Свойства
`protected _counter: HTMLElement`: Элемент счетчика.
`protected _catalog: HTMLElement`: Элемент каталога.
`wrapper: HTMLElement`: Элемент обертки.
`basket: HTMLElement`: Элемент корзины.
Методы
`set counter(value: number)`: Устанавливает значение счетчика.
Параметры:
`value`: Новое значение счетчика.
`set catalog(value: HTMLElement[])`: Устанавливает элементы каталога.
Параметры:
`value`: Новые элементы каталога.

### Порядок генерации и обработки событий:

1. Инициализация и подписка на события: Компоненты, такие как ViewBasket, Card, Form, Order, View и другие, создаются с использованием экземпляра EventEmitter. В процессе инициализации они подписываются на конкретные события через метод `on`.

2. Генерация и передача событий: Различные действия пользователей, например, добавление товара в корзину, отправка данных формы заказа или закрытие модального окна, инициируются внутри компонентов. При этом компоненты используют метод `emit` для отправки событий с соответствующими данными.

3. Обработка событий: Другие компоненты, подписанные на эти события, получают уведомления. Например, компонент ViewBasket, подписанный на событие добавления товара в корзину, обновляет список выбранных товаров и общую стоимость. Компонент Order, подписанный на событие отправки формы заказа, обрабатывает полученные данные.
